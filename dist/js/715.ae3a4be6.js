"use strict";(self["webpackChunkvue_losev_frontend"]=self["webpackChunkvue_losev_frontend"]||[]).push([[715],{8715:function(t,s,e){e.r(s),e.d(s,{default:function(){return z}});var o=e(3396),a=e(7139),i=e(9242);const l=(0,o._)("div",{class:"page_title"},[(0,o._)("p",null," Мої подкасти ")],-1),n={class:"all-podcast-block"},c={key:0,class:"no-podcasts-message"},d=(0,o._)("br",null,null,-1),r={key:1,class:"block_content_podcast"},u={class:"positions_in_block"},p={class:"upper_tittle"},g={class:"context"},h=["disabled","onClick"],y={class:"play-icon",xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 0 512 512"},P=["d"],m={class:"info_podcast"},v={class:"title_podcast"},_={class:"author_podcast"},k={class:"time_podcast"},b={class:"under_title"},f={class:"rating_and_categories"},w={class:"podcast-rating"},S={class:"categories_podcast"},A=["onClick"];function $(t,s,e,$,L,F){const q=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l,(0,o._)("div",n,[0===L.podcasts.length?((0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("p",null,[(0,o.Uk)(" Тут відображатимуться куплені подкасти."),d,(0,o.Uk)(" Придбайте свій перший подкаст "),(0,o.Wm)(q,{to:"/"},{default:(0,o.w5)((()=>[(0,o.Uk)("вже зараз")])),_:1}),(0,o.Uk)(". ")])])):((0,o.wg)(),(0,o.iD)("div",r,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(L.podcasts,(t=>(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:(0,a.C_)(["podcast",`id_${t.id}`,{podcast_blocked:t.blocked}]),style:(0,a.j5)({backgroundImage:`url(${t.image_url})`,backgroundRepeat:"no-repeat",backgroundPosition:"center"})},[(0,o._)("div",u,[(0,o._)("div",p,[(0,o._)("div",g,[(0,o._)("button",{class:"play-button",disabled:t.blocked,"aria-label":"Play podcast",onClick:s=>!t.blocked&&F.handlePlayButtonClick(t,s)},[((0,o.wg)(),(0,o.iD)("svg",y,[(0,o._)("path",{class:"play-path",d:F.isPlaying&&L.playingPodcast===t.id?L.pausePath:L.playPath},null,8,P)]))],8,h),(0,o._)("div",m,[(0,o._)("span",v,(0,a.zw)(F.truncateTitle(t.title)),1),(0,o._)("span",_,(0,a.zw)(t.author),1)])]),(0,o._)("span",k,(0,a.zw)(t.duration),1)]),(0,o._)("div",b,[(0,o._)("div",f,[(0,o._)("div",w,(0,a.zw)(t.rating),1),(0,o._)("span",S,(0,a.zw)(t.categories[0].name),1)]),(0,o._)("button",{class:(0,a.C_)(["heart-button",t.isFavorite?"active":""]),"aria-label":"favorite",onClick:s=>F.handleHeartButtonClick(t)},null,10,A)])])],6)),[[i.F8,t.isVisible]]))),128))]))])],64)}e(7658);var L=e(3258),F=e(5797),q=e.n(F),I={name:"MyPodcastPage",data(){return{podcasts:[],loading:!1,initialPodcasts:[],playingPodcast:null,audio:new Audio,playPath:"M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c-7.6 4.2-12.3 12.3-12.3 20.9V344c0 8.7 4.7 16.7 12.3 20.9s16.8 4.1 24.3-.5l144-88c7.1-4.4 11.5-12.1 11.5-20.5s-4.4-16.1-11.5-20.5l-144-88c-7.4-4.5-16.7-4.7-24.3-.5z",pausePath:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM224 192V320c0 17.7-14.3 32-32 32s-32-14.3-32-32V192c0-17.7 14.3-32 32-32s32 14.3 32 32zm128 0V320c0 17.7-14.3 32-32 32s-32-14.3-32-32V192c0-17.7 14.3-32 32-32s32 14.3 32 32z",showPaymentPopup:!1,selectedPaymentMethod:"",selectedPodcastId:null,isAuthenticated:!1}},computed:{isPlaying(){return console.log("isPlaying value from store:",this.$store.getters.isPlaying),this.$store.getters.isPlaying},playingPodcastId(){return this.$store.getters.playingPodcast.id},isPodcastFavorite(){return t=>this.$store.getters.isFavorite(t.id)}},watch:{isPlaying(t){!0===t?this.startAnimation():!1===t&&this.stopAnimation()}},methods:{openPaymentPopup(t){this.isAuthenticated?(this.selectedPodcastId=t,this.showPaymentPopup=!0):this.$router.push("/login")},closePaymentPopup(){this.selectedPodcastId=null,this.showPaymentPopup=!1},async makePayment(){const t=localStorage.getItem("token");console.log("podcast.id= "+this.selectedPodcastId);const s=this.selectedPodcastId;if("portmone"===this.selectedPaymentMethod)try{const e=await L.Z.submitPaymentPodcast(t,s,this.selectedPaymentMethod);e&&e.data&&e.data.order_link?window.location.href=e.data.order_link:e.error&&e.error.message&&"You need to login before continue"===e.error.message?q().toast({html:"Ви не авторизовані"}):console.error("Не вдалося отримати посилання для оплати")}catch(e){console.error("Помилка при оплаті:",e)}this.closePaymentPopup()},startAnimation(){console.log("start animation");const t=document.querySelector(`.podcast.id_${this.playingPodcastId}`);t&&(this.isPlaying=!this.isPlaying,this.playingPodcast=this.playingPodcastId,t.querySelector(".positions_in_block").classList.add("active"),t.classList.add("active"),t.querySelector(".context").classList.add("reversed"),t.querySelector(".play-button").classList.add("expanded"))},stopAnimation(){console.log("stop animation");const t=document.querySelector(`.podcast.id_${this.playingPodcast}`);t&&(t.querySelector(".positions_in_block").classList.remove("active"),t.classList.remove("active"),t.querySelector(".context").classList.remove("reversed"),t.querySelector(".play-button").classList.remove("expanded"),this.playingPodcast=null),console.log("stop this.playingPodcast= "+this.playingPodcast)},async handleHeartButtonClick(t){t.isFavorite=!t.isFavorite,console.log(t.isFavorite),this.$store.dispatch("toggleFavorite",t.id);const s=localStorage.getItem("token");try{const e=await L.Z.addAndRemoveToFavorite(s,t.id,`${this.$store.getters.isFavorite(t.id)}`);!0===e.data?(console.log("Операція успішна",e),this.$store.dispatch("updateIsFavoriteForPlayingPodcast",this.$store.getters.isFavorite(t.id))):e.error&&e.error.message&&"You need to login before continue"===e.error.message?q().toast({html:"Ви не авторизовані"}):null===e.data?console.error("Дані про улюблені подкасти ще не отримано:",e):console.error("Отримана неочікувана відповідь з сервера:",e)}catch(e){console.error("Помилка при додаванні або видаленні з улюблених:",e)}},stopPlayingPodcast(){const t=document.querySelector(`.podcast.id_${this.playingPodcast}`);t&&t.classList.remove("active");const s=document.querySelectorAll(".positions_in_block.active");s.forEach((t=>{t.classList.remove("active")}));const e=document.querySelectorAll(".podcast.active");e.forEach((t=>{t.classList.remove("active")}));const o=document.querySelectorAll(".context");o.forEach((t=>{t.classList.remove("reversed")}));const a=document.querySelectorAll(".play-button");a.forEach((t=>{t.classList.remove("expanded")})),this.playingPodcast=null,this.audio.removeEventListener("ended",this.stopPlayingPodcast.bind(this))},handlePlayButtonClick(t,s){if(this.playingPodcast===t.id?(this.$store.dispatch("togglePlayStatus"),this.isPlaying||this.stopPlayingPodcast(),this.playingPodcast=null):(null!==this.playingPodcast&&this.stopPlayingPodcast(),this.playingPodcast=t.id,this.$store.dispatch("updatePlayingPodcast",{imageUrl:t.image_url,author:t.author,title:t.title,duration:t.duration,id:t.id,audio_url:t.audio_url,isFavorite:t.isFavorite})),console.log("this.playingPodcast= "+this.playingPodcast),console.log("this.isPlaying= "+this.isPlaying),this.playingPodcast==t.id&&1==this.isPlaying){let t=s.target.closest(".positions_in_block");t.classList.toggle("active");let e=s.target.closest(".podcast");e.classList.toggle("active");const o=e.querySelector(".context");o.classList.toggle("reversed");const a=e.querySelector(".play-button");a.classList.toggle("expanded")}},async fetchPodcastDurations(){for(let t of this.podcasts){let s=new Audio(t.audio_url);s.addEventListener("loadedmetadata",(()=>{t.duration=this.formatTime(s.duration)}))}},formatTime(t){const s=Math.floor(t/60),e=Math.floor(t-60*s);return`${this.padZero(s)}:${this.padZero(e)}`},padZero(t){return t<10?`0${t}`:t},truncateTitle(t){return t.length>14?t.substring(0,14)+"...":t},applyAnimationBasedOnState(){this.isPlaying?this.startAnimation():this.stopAnimation()}},mounted(){this.loading=!0,this.applyAnimationBasedOnState();const t=localStorage.getItem("token");Promise.all([L.Z.getFavoritePodcasts(t),L.Z.getUserPodcasts(t)]).then((([t,s])=>{console.log("favoritePodcastsResponse:",t),console.log("userPodcastsResponse:",s.data);const e=t.data?t.data.map((t=>t.id)):[];console.log("userPodcastsResponse:",e),console.log("Before setting podcasts:",this.podcasts),this.podcasts=s?.data?.map((t=>({...t,isVisible:!0,isFavorite:e.includes(t.id)})))||[],console.log("After setting podcasts:",this.podcasts),console.log("Number of podcasts:",this.podcasts.length),this.$nextTick((()=>{this.fetchPodcastDurations()}))})).catch((t=>{console.error("Error:",t)})).finally((()=>{this.loading=!1}))},beforeUnmount(){document.removeEventListener("mousedown",this.checkOutsideClick)},async created(){this.loading=!0;const t=localStorage.getItem("token");this.isAuthenticated=Boolean(t),this.loading=!1}},C=e(89);const x=(0,C.Z)(I,[["render",$]]);var z=x}}]);
//# sourceMappingURL=715.ae3a4be6.js.map